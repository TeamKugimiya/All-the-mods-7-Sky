name: Auto Package

on:
  push:
    branches:
    - main
    paths:
    - ATM7-To_The_Sky
  workflow_dispatch: {}

jobs:
  Packer:
    runs-on: ubuntu-latest

    steps:
      - name: Checking Repostiory
        uses: actions/checkout@v2.0.0
        with:
          fetch-depth: 0
      
      - name: Fix FTBQuest path
        run: |
          cd ATM7-To_The_Sky/config
          mv ftbquests quests
          mkdir ftbquests
          mv quests ftbquests

      - name: Remove backup folder
        run: |
          cd ATM7-To_The_Sky
          rm -r backup

      - name: Move License
        run: |
          cp LICENSE ATM7-To_The_Sky/kubejs/assets/kubejs/lang/

      - name: Make ATM7 - To The Sky Archive
        run: |
          cd ATM7-To_The_Sky
          zip -r ../TranslateModPack-ATM7sky.zip *

      - name: Make Checksum
        id: checksum
        run: |
          echo "::set-output name=sum-01::$(sha256sum TranslateModPack-ATM7sky.zip)"

      - name: Make Git Version
        id: version
        run: |
          echo "::set-output name=sha_short::${GITHUB_SHA::7}"

      - name: Make Current Time
        id: current_time
        run: |
          echo "::set-output name=time::$(TZ='Asia/Taipei' date +'æœ€å¾Œæ›´æ–°ï¼š%Y å¹´ %m æœˆ %d æ—¥ %H é» %M åˆ†')"

      - name: Push Pack to Release
        uses: ncipollo/release-action@v1
        with:
          allowUpdates: true
          artifacts: "*.zip"
          token: ${{ secrets.GITHUB_TOKEN }}
          tag: latest
          name: æ¨¡çµ„ä»»å‹™ç¿»è­¯åŒ… (git ${{ steps.version.outputs.sha_short }})
          body: |
            ## ğŸ“ ä¸‹è¼‰
            ä¸‹è¼‰ä¸‹æ–¹çš„ Assets å…§çš„å°æ‡‰æ¨¡çµ„ä»»å‹™ç¿»è­¯åŒ…
            ä¸¦å°‡å…¶è§£å£“ç¸®**è¦†è“‹**è‡³ä½ çš„ `minecraft/` ç›®éŒ„ä¸­
            (è©²ç›®éŒ„å¿…é ˆæœ‰åŒæ™‚é¡¯ç¤º config resourcepack è³‡æ–™å¤¾ç­‰ç­‰ï¼Œæ‰æœƒæ˜¯æ­£ç¢ºçš„ä½ç½®)

            ## â­ æ›´æ–°
            å°‡æ–°ç‰ˆæœ¬çš„æ¨¡çµ„ç¿»è­¯åŒ…ä¸€æ¨£åœ¨ `minecraft/` è³‡æ–™å¤¾ä¸­å†åº¦è§£å£“ç¸®ä¸¦è¦†è“‹å³å¯ï¼

            > ${{ steps.current_time.outputs.time }}

            ## âœ… Checksum
            ```
            ${{ steps.checksum.outputs.sum-01 }}
            ```
